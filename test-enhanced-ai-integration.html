<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced AI Integration Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 2.5rem;
            font-weight: 700;
        }
        .header p {
            margin: 0;
            color: #666;
            font-size: 1.1rem;
        }
        .status-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        .status-connected {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #059669;
        }
        .status-disconnected {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-connected .status-dot {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        }
        .status-disconnected .status-dot {
            background: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .test-card h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-card p {
            margin: 0 0 20px 0;
            color: #666;
            line-height: 1.5;
        }
        .test-button {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .test-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .test-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
        }
        .result-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #059669;
        }
        .result-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
        .result-streaming {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
        }
        .streaming-text {
            white-space: pre-wrap;
        }
        .cursor {
            animation: blink 1s infinite;
            color: #667eea;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .models-list {
            background: rgba(102, 126, 234, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        .models-list h4 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }
        .model-item:last-child {
            border-bottom: none;
        }
        .model-name {
            font-weight: 500;
            color: #333;
        }
        .model-size {
            font-size: 0.8rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Enhanced AI Integration Test</h1>
            <p>Testing Vercel AI SDK + Ollama Integration with Streaming & Advanced Features</p>
        </div>

        <div id="connectionStatus" class="status-card status-disconnected">
            <div class="status-dot"></div>
            <div>
                <strong>Ollama Status:</strong> <span id="statusText">Checking connection...</span>
            </div>
        </div>

        <div id="modelsContainer" class="models-list" style="display: none;">
            <h4>ü§ñ Available Models</h4>
            <div id="modelsList">Loading models...</div>
        </div>

        <div class="test-grid">
            <!-- Basic Streaming Test -->
            <div class="test-card">
                <h3>üí¨ Basic Streaming Chat</h3>
                <p>Test real-time streaming responses with the enhanced AI service</p>
                <button class="test-button" onclick="testBasicStreaming()">
                    <span>Test Streaming</span>
                </button>
                <div id="streamingResult" class="test-result" style="display: none;"></div>
            </div>

            <!-- Educational Content Generation -->
            <div class="test-card">
                <h3>üìö Lesson Plan Generation</h3>
                <p>Generate a structured lesson plan with the enhanced educational AI</p>
                <button class="test-button" onclick="testLessonPlan()">
                    <span>Generate Lesson Plan</span>
                </button>
                <div id="lessonResult" class="test-result" style="display: none;"></div>
            </div>

            <!-- Quiz Generation -->
            <div class="test-card">
                <h3>üìù Interactive Quiz Creation</h3>
                <p>Create a structured quiz with multiple question types</p>
                <button class="test-button" onclick="testQuizGeneration()">
                    <span>Generate Quiz</span>
                </button>
                <div id="quizResult" class="test-result" style="display: none;"></div>
            </div>

            <!-- Personalized Tutoring -->
            <div class="test-card">
                <h3>üéØ Personalized Tutoring</h3>
                <p>Test adaptive tutoring with Socratic method</p>
                <button class="test-button" onclick="testTutoring()">
                    <span>Test Tutoring</span>
                </button>
                <div id="tutoringResult" class="test-result" style="display: none;"></div>
            </div>

            <!-- Assessment Rubric -->
            <div class="test-card">
                <h3>üìä Assessment Rubric</h3>
                <p>Generate detailed assessment rubrics</p>
                <button class="test-button" onclick="testRubric()">
                    <span>Generate Rubric</span>
                </button>
                <div id="rubricResult" class="test-result" style="display: none;"></div>
            </div>

            <!-- Parent Report -->
            <div class="test-card">
                <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Report</h3>
                <p>Generate comprehensive parent communication</p>
                <button class="test-button" onclick="testParentReport()">
                    <span>Generate Report</span>
                </button>
                <div id="reportResult" class="test-result" style="display: none;"></div>
            </div>
        </div>

        <div class="container">
            <h3>üéØ Integration Summary</h3>
            <ul>
                <li><strong>Vercel AI SDK:</strong> Integrated for streaming and structured generation</li>
                <li><strong>Custom Ollama Provider:</strong> Built to work with Vercel AI SDK</li>
                <li><strong>Enhanced Hooks:</strong> React hooks for streaming and educational AI</li>
                <li><strong>Smart Model Routing:</strong> Automatic model selection based on task type</li>
                <li><strong>Educational Specialization:</strong> Purpose-built functions for education</li>
                <li><strong>Real-time Streaming:</strong> Live response generation with cursor animation</li>
            </ul>
        </div>
    </div>

    <script>
        const baseURL = 'http://localhost:11434';
        let isConnected = false;

        // Check connection and load models
        async function checkConnection() {
            try {
                const response = await fetch(`${baseURL}/api/tags`);
                if (response.ok) {
                    isConnected = true;
                    document.getElementById('connectionStatus').className = 'status-card status-connected';
                    document.getElementById('statusText').textContent = 'Connected to Ollama ‚úÖ';
                    
                    const data = await response.json();
                    displayModels(data.models || []);
                } else {
                    throw new Error('Ollama not responding');
                }
            } catch (error) {
                isConnected = false;
                document.getElementById('connectionStatus').className = 'status-card status-disconnected';
                document.getElementById('statusText').textContent = 'Disconnected - Make sure Ollama is running ‚ùå';
            }
        }

        function displayModels(models) {
            const container = document.getElementById('modelsContainer');
            const list = document.getElementById('modelsList');
            
            if (models.length > 0) {
                list.innerHTML = models.map(model => `
                    <div class="model-item">
                        <span class="model-name">${model.name}</span>
                        <span class="model-size">${model.details?.parameter_size || 'Unknown size'}</span>
                    </div>
                `).join('');
                container.style.display = 'block';
            }
        }

        // Generic streaming function
        async function streamFromOllama(prompt, systemPrompt, onChunk, onComplete) {
            const messages = [];
            if (systemPrompt) {
                messages.push({ role: 'system', content: systemPrompt });
            }
            messages.push({ role: 'user', content: prompt });

            const response = await fetch(`${baseURL}/api/chat`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'qwen2.5:3b-instruct',
                    messages: messages,
                    stream: true
                }),
            });

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let fullText = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const chunk = decoder.decode(value);
                const lines = chunk.split('\n').filter(line => line.trim());

                for (const line of lines) {
                    try {
                        const data = JSON.parse(line);
                        if (data.message?.content) {
                            fullText += data.message.content;
                            onChunk(data.message.content);
                        }
                    } catch (e) {
                        // Skip invalid JSON
                    }
                }
            }

            onComplete(fullText);
        }

        // Test functions
        async function testBasicStreaming() {
            const button = event.target;
            const resultDiv = document.getElementById('streamingResult');
            
            if (!isConnected) {
                showError(resultDiv, 'Not connected to Ollama');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<span class="spinner">‚ü≥</span> Streaming...';
            
            resultDiv.className = 'test-result result-streaming';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="streaming-text"></div>';
            
            const streamingText = resultDiv.querySelector('.streaming-text');

            try {
                await streamFromOllama(
                    "Hello! Please introduce yourself as Aura Concierge and explain how you can help with education.",
                    "You are Aura Concierge, an AI assistant for education. Be friendly and helpful.",
                    (chunk) => {
                        streamingText.textContent += chunk;
                        streamingText.innerHTML += '<span class="cursor">‚ñä</span>';
                        setTimeout(() => {
                            const cursor = streamingText.querySelector('.cursor');
                            if (cursor) cursor.remove();
                        }, 100);
                    },
                    (fullText) => {
                        resultDiv.className = 'test-result result-success';
                        streamingText.innerHTML = fullText;
                        button.disabled = false;
                        button.innerHTML = '<span>Test Streaming</span>';
                    }
                );
            } catch (error) {
                showError(resultDiv, error.message);
                button.disabled = false;
                button.innerHTML = '<span>Test Streaming</span>';
            }
        }

        async function testLessonPlan() {
            const button = event.target;
            const resultDiv = document.getElementById('lessonResult');
            
            if (!isConnected) {
                showError(resultDiv, 'Not connected to Ollama');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<span class="spinner">‚ü≥</span> Generating...';

            try {
                const response = await fetch(`${baseURL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'qwen2.5:3b-instruct',
                        messages: [{
                            role: 'system',
                            content: 'You are an expert educational AI. Create structured lesson plans with clear objectives, activities, and assessments.'
                        }, {
                            role: 'user',
                            content: 'Create a lesson plan for 5th grade math on fractions. Include objectives, materials, activities, and assessment.'
                        }],
                        stream: false
                    }),
                });

                const data = await response.json();
                showSuccess(resultDiv, data.message.content);
            } catch (error) {
                showError(resultDiv, error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = '<span>Generate Lesson Plan</span>';
            }
        }

        async function testQuizGeneration() {
            const button = event.target;
            const resultDiv = document.getElementById('quizResult');
            
            if (!isConnected) {
                showError(resultDiv, 'Not connected to Ollama');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<span class="spinner">‚ü≥</span> Creating Quiz...';

            try {
                const response = await fetch(`${baseURL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'qwen2.5:3b-instruct',
                        messages: [{
                            role: 'system',
                            content: 'You create educational quizzes. Generate 3 multiple-choice questions with explanations.'
                        }, {
                            role: 'user',
                            content: 'Create a quiz about the solar system for 3rd graders. Include 3 multiple-choice questions with explanations.'
                        }],
                        stream: false
                    }),
                });

                const data = await response.json();
                showSuccess(resultDiv, data.message.content);
            } catch (error) {
                showError(resultDiv, error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = '<span>Generate Quiz</span>';
            }
        }

        async function testTutoring() {
            const button = event.target;
            const resultDiv = document.getElementById('tutoringResult');
            
            if (!isConnected) {
                showError(resultDiv, 'Not connected to Ollama');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<span class="spinner">‚ü≥</span> Tutoring...';

            try {
                const response = await fetch(`${baseURL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'qwen2.5:3b-instruct',
                        messages: [{
                            role: 'system',
                            content: 'You are a patient tutor using the Socratic method. Guide students to discover answers themselves.'
                        }, {
                            role: 'user',
                            content: 'I need help with this math problem: What is 15 √ó 8? Can you help me understand how to solve it?'
                        }],
                        stream: false
                    }),
                });

                const data = await response.json();
                showSuccess(resultDiv, data.message.content);
            } catch (error) {
                showError(resultDiv, error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = '<span>Test Tutoring</span>';
            }
        }

        async function testRubric() {
            const button = event.target;
            const resultDiv = document.getElementById('rubricResult');
            
            if (!isConnected) {
                showError(resultDiv, 'Not connected to Ollama');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<span class="spinner">‚ü≥</span> Creating Rubric...';

            try {
                const response = await fetch(`${baseURL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'qwen2.5:3b-instruct',
                        messages: [{
                            role: 'system',
                            content: 'You create detailed assessment rubrics for educational assignments.'
                        }, {
                            role: 'user',
                            content: 'Create an assessment rubric for a 4th grade science project on plants. Include criteria for research, presentation, and creativity.'
                        }],
                        stream: false
                    }),
                });

                const data = await response.json();
                showSuccess(resultDiv, data.message.content);
            } catch (error) {
                showError(resultDiv, error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = '<span>Generate Rubric</span>';
            }
        }

        async function testParentReport() {
            const button = event.target;
            const resultDiv = document.getElementById('reportResult');
            
            if (!isConnected) {
                showError(resultDiv, 'Not connected to Ollama');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<span class="spinner">‚ü≥</span> Writing Report...';

            try {
                const response = await fetch(`${baseURL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'qwen2.5:3b-instruct',
                        messages: [{
                            role: 'system',
                            content: 'You write professional, encouraging parent reports about student progress.'
                        }, {
                            role: 'user',
                            content: 'Write a parent report for Emma in 3rd grade math. She excels at addition and subtraction but needs help with multiplication tables. Be encouraging and provide suggestions.'
                        }],
                        stream: false
                    }),
                });

                const data = await response.json();
                showSuccess(resultDiv, data.message.content);
            } catch (error) {
                showError(resultDiv, error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = '<span>Generate Report</span>';
            }
        }

        function showSuccess(element, content) {
            element.className = 'test-result result-success';
            element.style.display = 'block';
            element.textContent = content;
        }

        function showError(element, message) {
            element.className = 'test-result result-error';
            element.style.display = 'block';
            element.textContent = `Error: ${message}`;
        }

        // Initialize
        checkConnection();
    </script>
</body>
</html>
