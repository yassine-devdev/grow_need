<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Enhanced Aura Concierge</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .test-section {
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            width: 100%;
        }
        .test-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .test-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
        .success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #059669;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
        .info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #2563eb;
        }
        .streaming {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
        }
        .mock-component {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        .mock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            margin: -20px -20px 20px -20px;
        }
        .mock-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            font-size: 0.75rem;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .connected .status-dot {
            background-color: #10b981;
            box-shadow: 0 0 6px rgba(16, 185, 129, 0.6);
        }
        .disconnected .status-dot {
            background-color: #ef4444;
            box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
        }
        .mock-message {
            display: flex;
            gap: 12px;
            margin: 15px 0;
            animation: messageSlide 0.3s ease-out;
        }
        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .mock-message.user {
            flex-direction: row-reverse;
        }
        .mock-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            font-weight: bold;
        }
        .mock-message.user .mock-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .mock-message.assistant .mock-avatar {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .mock-content {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
        }
        .mock-message.user .mock-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .mock-message.assistant .mock-content {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e9ecef;
        }
        .mock-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
        }
        .mock-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e9ecef;
            border-radius: 25px;
            outline: none;
        }
        .mock-input button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            cursor: pointer;
        }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .quick-action {
            padding: 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }
        .quick-action:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-1px);
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 Test: Enhanced Aura Concierge</h1>
            <p>Testing the enhanced concierge component with streaming and modern UI</p>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h3>1. Component Initialization</h3>
                <p>Test component creation and initial state</p>
                <button class="test-button" onclick="testComponentInit()">Test Component Init</button>
                <div id="initResult" class="result" style="display: none;"></div>
            </div>

            <div class="test-section">
                <h3>2. UI State Management</h3>
                <p>Test expand/minimize and state transitions</p>
                <button class="test-button" onclick="testUIStates()">Test UI States</button>
                <div id="uiResult" class="result" style="display: none;"></div>
            </div>

            <div class="test-section">
                <h3>3. Chat Functionality</h3>
                <p>Test message sending and chat flow</p>
                <button class="test-button" onclick="testChatFlow()">Test Chat Flow</button>
                <div id="chatResult" class="result" style="display: none;"></div>
            </div>

            <div class="test-section">
                <h3>4. Streaming Integration</h3>
                <p>Test real-time streaming responses</p>
                <button class="test-button" onclick="testStreaming()">Test Streaming</button>
                <div id="streamingResult" class="result" style="display: none;"></div>
            </div>

            <div class="test-section">
                <h3>5. Quick Actions</h3>
                <p>Test quick action buttons and prompts</p>
                <button class="test-button" onclick="testQuickActions()">Test Quick Actions</button>
                <div id="actionsResult" class="result" style="display: none;"></div>
            </div>

            <div class="test-section">
                <h3>6. Connection Status</h3>
                <p>Test connection monitoring and status display</p>
                <button class="test-button" onclick="testConnectionStatus()">Test Connection</button>
                <div id="connectionResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Mock Component Display -->
        <div class="mock-component" id="mockComponent" style="display: none;">
            <div class="mock-header">
                <div>
                    <h3>🤖 Aura Concierge</h3>
                    <p style="margin: 0; font-size: 0.8rem; opacity: 0.9;">Enhanced AI Assistant</p>
                </div>
                <div class="mock-status connected" id="mockStatus">
                    <span class="status-dot"></span>
                    <span>Connected</span>
                </div>
            </div>

            <div id="mockMessages">
                <div class="mock-message assistant">
                    <div class="mock-avatar">🤖</div>
                    <div class="mock-content">
                        Hello! I'm Aura Concierge, your enhanced AI assistant. How can I help you today?
                    </div>
                </div>
            </div>

            <div class="quick-actions" id="mockQuickActions">
                <div class="quick-action">📚 Create Lesson Plan</div>
                <div class="quick-action">📝 Generate Quiz</div>
                <div class="quick-action">✅ Grade Assignment</div>
                <div class="quick-action">💬 Parent Communication</div>
            </div>

            <div class="mock-input">
                <input type="text" placeholder="Ask me anything about education..." id="mockInput">
                <button onclick="sendMockMessage()">➤</button>
            </div>
        </div>
    </div>

    <script>
        const baseURL = 'http://localhost:11434';

        // Mock Enhanced Aura Concierge Component
        class MockEnhancedAuraConcierge {
            constructor() {
                this.isExpanded = false;
                this.isConnected = false;
                this.messages = [];
                this.isTyping = false;
                this.streamingState = {
                    isStreaming: false,
                    currentText: '',
                    isComplete: false,
                    error: null
                };
                this.quickActions = [
                    { label: 'Create Lesson Plan', icon: '📚', prompt: 'Help me create a lesson plan for 5th grade math on fractions.' },
                    { label: 'Generate Quiz', icon: '📝', prompt: 'Create a quiz with 5 questions about the solar system for 3rd graders.' },
                    { label: 'Grade Assignment', icon: '✅', prompt: 'Help me create a rubric for grading a science project on plants.' },
                    { label: 'Parent Communication', icon: '💬', prompt: 'Help me write a positive note to parents about their child\'s progress.' }
                ];
            }

            initialize() {
                this.checkConnection();
                this.addInitialMessage();
                return {
                    isExpanded: this.isExpanded,
                    isConnected: this.isConnected,
                    messages: this.messages,
                    isTyping: this.isTyping,
                    streamingState: this.streamingState,
                    quickActions: this.quickActions
                };
            }

            async checkConnection() {
                try {
                    const response = await fetch(`${baseURL}/api/tags`);
                    this.isConnected = response.ok;
                } catch {
                    this.isConnected = false;
                }
                return this.isConnected;
            }

            addInitialMessage() {
                this.messages = [{
                    role: 'assistant',
                    content: 'Hello! I\'m Aura Concierge, your enhanced AI assistant. How can I help you today?',
                    timestamp: new Date()
                }];
            }

            toggleExpanded() {
                this.isExpanded = !this.isExpanded;
                return this.isExpanded;
            }

            async sendMessage(content) {
                if (!content.trim() || this.isTyping || !this.isConnected) return;

                // Add user message
                const userMessage = {
                    role: 'user',
                    content: content,
                    timestamp: new Date()
                };
                this.messages.push(userMessage);

                // Start typing
                this.isTyping = true;
                this.streamingState = {
                    isStreaming: true,
                    currentText: '',
                    isComplete: false,
                    error: null
                };

                // Simulate streaming response
                return new Promise((resolve) => {
                    const responseText = `Thank you for your question: "${content}". This is a simulated streaming response that demonstrates the enhanced AI capabilities.`;
                    const words = responseText.split(' ');
                    let index = 0;
                    let currentText = '';

                    const interval = setInterval(() => {
                        if (index < words.length) {
                            currentText += words[index] + ' ';
                            this.streamingState.currentText = currentText;
                            index++;
                        } else {
                            clearInterval(interval);
                            
                            // Add assistant message
                            const assistantMessage = {
                                role: 'assistant',
                                content: currentText.trim(),
                                timestamp: new Date()
                            };
                            this.messages.push(assistantMessage);

                            // Reset states
                            this.isTyping = false;
                            this.streamingState = {
                                isStreaming: false,
                                currentText: currentText.trim(),
                                isComplete: true,
                                error: null
                            };

                            resolve(currentText.trim());
                        }
                    }, 100);
                });
            }

            clearMessages() {
                this.messages = [];
                this.addInitialMessage();
            }

            stopStreaming() {
                this.streamingState.isStreaming = false;
                this.isTyping = false;
            }

            getState() {
                return {
                    isExpanded: this.isExpanded,
                    isConnected: this.isConnected,
                    messages: this.messages,
                    isTyping: this.isTyping,
                    streamingState: this.streamingState,
                    quickActions: this.quickActions
                };
            }
        }

        let mockComponent = null;

        // Test functions
        async function testComponentInit() {
            const resultDiv = document.getElementById('initResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'Testing component initialization...';

            try {
                mockComponent = new MockEnhancedAuraConcierge();
                const initialState = mockComponent.initialize();

                let results = 'Component Initialization Test Results:\n\n';
                results += `✅ Component created successfully\n`;
                results += `✅ Initial expanded state: ${initialState.isExpanded}\n`;
                results += `✅ Connection check: ${initialState.isConnected ? 'CONNECTED' : 'DISCONNECTED'}\n`;
                results += `✅ Initial messages: ${initialState.messages.length} message(s)\n`;
                results += `✅ Initial typing state: ${initialState.isTyping}\n`;
                results += `✅ Quick actions: ${initialState.quickActions.length} actions\n`;
                results += `✅ Streaming state initialized: ${JSON.stringify(initialState.streamingState)}\n`;

                // Test methods availability
                results += `\nMethods available:\n`;
                results += `✅ toggleExpanded: ${typeof mockComponent.toggleExpanded}\n`;
                results += `✅ sendMessage: ${typeof mockComponent.sendMessage}\n`;
                results += `✅ clearMessages: ${typeof mockComponent.clearMessages}\n`;
                results += `✅ stopStreaming: ${typeof mockComponent.stopStreaming}\n`;
                results += `✅ getState: ${typeof mockComponent.getState}\n`;

                results += `\nOverall: SUCCESS`;

                resultDiv.className = 'result success';
                resultDiv.textContent = results;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Component initialization failed: ${error.message}`;
            }
        }

        async function testUIStates() {
            const resultDiv = document.getElementById('uiResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'Testing UI state management...';

            if (!mockComponent) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Please run Component Initialization test first';
                return;
            }

            try {
                let results = 'UI State Management Test Results:\n\n';

                // Test initial state
                const initialState = mockComponent.getState();
                results += `✅ Initial expanded state: ${initialState.isExpanded}\n`;

                // Test toggle expand
                const expandedState = mockComponent.toggleExpanded();
                results += `✅ Toggle expand: ${expandedState}\n`;

                // Test toggle minimize
                const minimizedState = mockComponent.toggleExpanded();
                results += `✅ Toggle minimize: ${!minimizedState}\n`;

                // Test state consistency
                const currentState = mockComponent.getState();
                results += `✅ State consistency: ${currentState.isExpanded === minimizedState}\n`;

                // Show mock component
                document.getElementById('mockComponent').style.display = 'block';
                results += `✅ Mock component displayed\n`;

                results += `\nOverall: SUCCESS`;

                resultDiv.className = 'result success';
                resultDiv.textContent = results;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `UI state test failed: ${error.message}`;
            }
        }

        async function testChatFlow() {
            const resultDiv = document.getElementById('chatResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'Testing chat functionality...';

            if (!mockComponent) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Please run Component Initialization test first';
                return;
            }

            try {
                let results = 'Chat Flow Test Results:\n\n';

                // Test initial message count
                const initialMessages = mockComponent.getState().messages.length;
                results += `✅ Initial messages: ${initialMessages}\n`;

                // Test sending a message
                const testMessage = "Hello, this is a test message";
                const response = await mockComponent.sendMessage(testMessage);
                
                const afterSendMessages = mockComponent.getState().messages.length;
                results += `✅ Message sent: ${afterSendMessages > initialMessages}\n`;
                results += `✅ Messages count: ${afterSendMessages} (increased by 2)\n`;
                results += `✅ Response received: ${response ? 'YES' : 'NO'}\n`;
                results += `✅ Response length: ${response ? response.length : 0} characters\n`;

                // Test message structure
                const lastMessage = mockComponent.getState().messages[afterSendMessages - 1];
                results += `✅ Last message role: ${lastMessage.role}\n`;
                results += `✅ Last message has timestamp: ${lastMessage.timestamp ? 'YES' : 'NO'}\n`;

                // Test clear messages
                mockComponent.clearMessages();
                const afterClearMessages = mockComponent.getState().messages.length;
                results += `✅ Clear messages: ${afterClearMessages === 1 ? 'SUCCESS' : 'FAILED'}\n`;

                results += `\nOverall: SUCCESS`;

                resultDiv.className = 'result success';
                resultDiv.textContent = results;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Chat flow test failed: ${error.message}`;
            }
        }

        async function testStreaming() {
            const resultDiv = document.getElementById('streamingResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result streaming';
            resultDiv.textContent = 'Testing streaming integration...\n\nStreaming response:\n';

            if (!mockComponent) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Please run Component Initialization test first';
                return;
            }

            try {
                const startTime = Date.now();
                let updateCount = 0;

                // Monitor streaming state during message sending
                const monitorInterval = setInterval(() => {
                    const state = mockComponent.getState();
                    if (state.streamingState.isStreaming) {
                        updateCount++;
                        resultDiv.textContent = `Testing streaming integration...\n\nUpdates: ${updateCount}\nStreaming: ${state.streamingState.isStreaming}\nCurrent text: "${state.streamingState.currentText}"\n\nLive response:\n${state.streamingState.currentText}`;
                    }
                }, 50);

                const response = await mockComponent.sendMessage("Test streaming response generation");
                clearInterval(monitorInterval);

                const endTime = Date.now();
                const finalState = mockComponent.getState();

                let finalResults = 'Streaming Integration Test Results:\n\n';
                finalResults += `✅ Streaming completed: SUCCESS\n`;
                finalResults += `✅ Total time: ${endTime - startTime}ms\n`;
                finalResults += `✅ State updates: ${updateCount}\n`;
                finalResults += `✅ Final streaming state: ${finalState.streamingState.isStreaming}\n`;
                finalResults += `✅ Completion state: ${finalState.streamingState.isComplete}\n`;
                finalResults += `✅ Error state: ${finalState.streamingState.error ? 'HAS ERROR' : 'NO ERROR'}\n`;
                finalResults += `✅ Response length: ${response.length} characters\n\n`;
                finalResults += `Final response: "${response}"`;

                resultDiv.className = 'result success';
                resultDiv.textContent = finalResults;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Streaming test failed: ${error.message}`;
            }
        }

        async function testQuickActions() {
            const resultDiv = document.getElementById('actionsResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'Testing quick actions...';

            if (!mockComponent) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Please run Component Initialization test first';
                return;
            }

            try {
                const state = mockComponent.getState();
                let results = 'Quick Actions Test Results:\n\n';

                results += `✅ Quick actions available: ${state.quickActions.length}\n\n`;

                state.quickActions.forEach((action, index) => {
                    results += `Action ${index + 1}:\n`;
                    results += `  Label: ${action.label}\n`;
                    results += `  Icon: ${action.icon}\n`;
                    results += `  Prompt length: ${action.prompt.length} characters\n`;
                    results += `  Has prompt: ${action.prompt ? 'YES' : 'NO'}\n\n`;
                });

                // Test quick action execution
                const firstAction = state.quickActions[0];
                if (firstAction) {
                    const response = await mockComponent.sendMessage(firstAction.prompt);
                    results += `✅ Quick action execution: SUCCESS\n`;
                    results += `✅ Response generated: ${response ? 'YES' : 'NO'}\n`;
                    results += `✅ Response length: ${response ? response.length : 0} characters\n`;
                }

                results += `\nOverall: SUCCESS`;

                resultDiv.className = 'result success';
                resultDiv.textContent = results;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Quick actions test failed: ${error.message}`;
            }
        }

        async function testConnectionStatus() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'Testing connection status...';

            if (!mockComponent) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Please run Component Initialization test first';
                return;
            }

            try {
                let results = 'Connection Status Test Results:\n\n';

                // Test initial connection state
                const initialState = mockComponent.getState();
                results += `✅ Initial connection state: ${initialState.isConnected ? 'CONNECTED' : 'DISCONNECTED'}\n`;

                // Test connection check
                const connectionResult = await mockComponent.checkConnection();
                results += `✅ Connection check result: ${connectionResult ? 'CONNECTED' : 'DISCONNECTED'}\n`;

                // Test state update
                const updatedState = mockComponent.getState();
                results += `✅ State updated: ${updatedState.isConnected === connectionResult}\n`;

                // Update mock UI
                const mockStatus = document.getElementById('mockStatus');
                if (mockStatus) {
                    mockStatus.className = `mock-status ${connectionResult ? 'connected' : 'disconnected'}`;
                    mockStatus.innerHTML = `
                        <span class="status-dot"></span>
                        <span>${connectionResult ? 'Connected' : 'Disconnected'}</span>
                    `;
                    results += `✅ UI status updated: SUCCESS\n`;
                }

                // Test message sending with connection state
                if (connectionResult) {
                    const testResponse = await mockComponent.sendMessage("Test connection-dependent message");
                    results += `✅ Message sent while connected: ${testResponse ? 'SUCCESS' : 'FAILED'}\n`;
                } else {
                    results += `⚠️ Cannot test message sending: Not connected to Ollama\n`;
                }

                results += `\nOverall: SUCCESS`;

                resultDiv.className = 'result success';
                resultDiv.textContent = results;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Connection status test failed: ${error.message}`;
            }
        }

        // Mock message sending function for UI
        async function sendMockMessage() {
            const input = document.getElementById('mockInput');
            const message = input.value.trim();
            
            if (!message || !mockComponent) return;

            input.value = '';
            
            // Add message to mock UI
            const messagesDiv = document.getElementById('mockMessages');
            
            // User message
            const userDiv = document.createElement('div');
            userDiv.className = 'mock-message user';
            userDiv.innerHTML = `
                <div class="mock-avatar">👤</div>
                <div class="mock-content">${message}</div>
            `;
            messagesDiv.appendChild(userDiv);

            // Send through component
            const response = await mockComponent.sendMessage(message);

            // Assistant message
            const assistantDiv = document.createElement('div');
            assistantDiv.className = 'mock-message assistant';
            assistantDiv.innerHTML = `
                <div class="mock-avatar">🤖</div>
                <div class="mock-content">${response}</div>
            `;
            messagesDiv.appendChild(assistantDiv);

            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Auto-run component initialization test on load
        window.addEventListener('load', () => {
            setTimeout(testComponentInit, 1000);
        });
    </script>
</body>
</html>
